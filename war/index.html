<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>GDGChugokuSample</title>
</head>
<body>
	<div>
		<a id="login" href="">ログイン</a>
	</div>

	<input type="button" id="refresh" value="refresh" />
	<div id="todo_list"></div>
	<hr />

	ToDoを入れてね！
	<form id="form" method="post" action="dummy">
		<input type="text" id="memo" name="memo" /> <input type="submit"
			value="add" />
	</form>

	<script
		src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script>
		window.jQuery
				|| document
						.write('<script src="/lib/jquery/jquery-1.7.2.min.js"><\/script>')
	</script>
	<script>
		$(function() {
			var refresh = function() {
				var onError = function(data, status, xhr) {
					console.log('error');
				};

				var onSuccess = function(data, status, xhr) {
					console.log('success');
					if (data['loginUrl']) {
						$('#login').attr('href', data['loginUrl']);
						return;
					}
					$('#todo_list ul').remove();
					var ul = $('<ul/>');
					$.each(data, function(_, toDo) {
						var li = $('<li/>')
	    				  .text(toDo['memo'] + 
	    				  '(' + new Date(toDo['entryDate']) + ')');
						li.appendTo(ul);
					});
					ul.appendTo('#todo_list');
				};

				$.ajax({
					url : '/toDo',
					type : 'GET',
				}).success(onSuccess).error(onError);
				;
				return false;
			}
			$('#refresh').click(refresh);
		})

		$(function() {
			var submit = function(event) {
				var memo = $('#memo');

				var onError = function(data, status, xhr) {
					console.log('error');
				};

				var onSuccess = function(data, status, xhr) {
					console.log('success');
				};

				$.ajax({
					url : '/toDo',
					type : 'POST',
					data : memo
				}).success(onSuccess).error(onError);
				return false;
			}
			$('#form').submit(submit);
		})
	</script>
</body>
</html>
